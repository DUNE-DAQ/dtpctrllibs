/**
 * @file DTPWrapper.hpp FELIX's FlxCard library wrapper
 *
 * This is part of the DUNE DAQ , copyright 2020.
 * Licensing/copyright details are in the COPYING file that you should have
 * received with this code.
 */
#ifndef FLXLIBS_SRC_CARDWRAPPER_HPP_
#define FLXLIBS_SRC_CARDWRAPPER_HPP_

#include "flxlibs/felixcardreader/Nljs.hpp"
#include "flxlibs/felixcardreader/Structs.hpp"

#include "readoutlibs/utils/ReusableThread.hpp"

#include "flxcard/FlxCard.h"
#include "packetformat/block_format.hpp"

#include <nlohmann/json.hpp>

#include <atomic>
#include <memory>
#include <mutex>
#include <string>

namespace dunedaq::flxlibs {

class DTPWrapper
{
public:
  /**
   * @brief DTPWrapper Constructor
   * @param name Instance name for this DTPWrapper instance
   */
  DTPWrapper();
  ~DTPWrapper();
  DTPWrapper(const DTPWrapper&) = delete;            ///< DTPWrapper is not copy-constructible
  DTPWrapper& operator=(const DTPWrapper&) = delete; ///< DTPWrapper is not copy-assignable
  DTPWrapper(DTPWrapper&&) = delete;                 ///< DTPWrapper is not move-constructible
  DTPWrapper& operator=(DTPWrapper&&) = delete;      ///< DTPWrapper is not move-assignable

  using data_t = nlohmann::json;
  void init(const data_t& args);
  void configure(const data_t& args);
  void start(const data_t& args);
  void stop(const data_t& args);
  void set_running(bool should_run);

private:
  // Types
  using module_conf_t = dunedaq::flxlibs::felixcardreader::Conf;

  // Constants

  using UniqueFlxDTP = std::unique_ptr<FlxDTP>;
  UniqueFlxDTP m_flx_card;
  std::mutex m_card_mutex;

};

} // namespace dunedaq::dtplibs

#endif // DTPLIBS_SRC_DTPWRAPPER_HPP_
